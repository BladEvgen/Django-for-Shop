{% extends "components/base.html" %}
{% load django_app_filters_and_tags %}
{% block main %}
{% check_access "moder_seller" as access %}
{% if access %}
<div class="container mt-5">
    <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
    <a href="{% url 'order_list' %}" class="btn btn-outline-primary mb-3">
        <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤
    </a>

    <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <h3 class="text-primary">üë§ –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è:</h3>
    <div class="row mb-4">
        <div class="col-md-6">
            <p><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ order.user.last_name }}</p>
            <p><strong>–ò–º—è:</strong> {{ order.user.first_name }}</p>
        </div>
        <div class="col-md-6">
            <p><strong>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</strong> {{ order.user.profile.phonenumber }}</p>
            <p><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.user.profile.address }}</p>
        </div>
    </div>

    <!-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ -->
    <form method="post" action="{% url 'update_order_status' order.id %}" class="mb-5">
        {% csrf_token %}
        <h3 class="text-primary">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞:</h3>
        <div class="form-group">
            <label for="new_status">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:</label>
            <select name="new_status" id="new_status" class="form-select">
                {% for status in order.STATUS_CHOICES %}
                <option value="{{ status.0 }}" {% if order.status == status.0 %}selected{% endif %}>{{ status.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-success mt-3">
            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        </button>
    </form>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö -->
    <h3 class="text-primary">üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö:</h3>
    <div class="table-responsive">
        <table class="table table-bordered table-hover mt-3">
            <thead class="table-light">
                <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th class="text-center">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th class="text-center">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
                    <th class="text-center">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
                </tr>
            </thead>
            <tbody>
                {% for order_item in order.order_items.all %}
                <tr>
                    <td>{{ order_item.item.title }}</td>
                    <td class="text-center">{{ order_item.quantity }} —à—Ç</td>
                    <td class="text-center">{{ order_item.item.discounted_price|default:order_item.item.price }} ‚Ç∏</td>
                    <td class="text-center">{{ order_item.calculate_item_total }} ‚Ç∏</td>
                </tr>
                {% endfor %}
                <tr class="table-secondary">
                    <td colspan="3" class="text-end"><strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong></td>
                    <td class="text-center"><strong>{{ order.get_total_price }} ‚Ç∏</strong></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="container mt-5 text-center">
    <h2 class="text-danger">üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>
    <p>–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.</p>
</div>
{% endif %}
{% endblock %}
